"use strict";function ownKeys(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(r,!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(r).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var btnCreate=document.querySelector(".list__button"),listInput=document.querySelector(".list__input"),listSelectStatus=document.querySelector(".list__select-status"),listSelectPriority=document.querySelector(".list__select-priority"),modal=document.querySelector(".modal"),modalSave=document.querySelector(".modal__button-save"),modalCancel=document.querySelector(".modal__button-cancel"),body=document.querySelector("body"),modalFade=document.querySelector(".modal__fade"),currentId=null,taskArray=[],idForArrayItems=0,titleField=document.getElementById("title"),descriptionField=document.getElementById("description"),priorityField=document.getElementById("priority");function findArrayElement(e,t){var r=null;return e.forEach(function(e){e.id===Number(t)&&(r=e)}),r}function replaceArrayElement(e,t){return e.map(function(e){return e.id===t.id?t:e})}function removeArrayElement(e,t){return e.filter(function(e){return e.id!==t.id})}function clearSearchFields(){listInput.value="",listSelectStatus.selectedIndex=0,listSelectPriority.selectedIndex=0}function createTask(e){if("number"!=typeof e||Number.isNaN(e))currentId=null;else{var t=findArrayElement(taskArray,e),r=t.title,n=t.description,i=t.priority,l=t.id;titleField.value=r,descriptionField.value=n,priorityField.value=i,currentId=l}modal.style.display="block",titleField.focus(),clearSearchFields()}function deleteTask(e){var t=findArrayElement(taskArray,e);createElements(taskArray=removeArrayElement(taskArray,t)),clearSearchFields()}function doneTask(e){var t=findArrayElement(taskArray,e);t=_objectSpread({},t,{done:!t.done}),createElements(taskArray=replaceArrayElement(taskArray,t)),clearSearchFields()}function addEvents(e,r,t,n,i){r.forEach(function(e){e.style.display="none"}),e.forEach(function(e,t){e.addEventListener("click",function(){return function(e){r[e].style.display="none"===r[e].style.display?"flex":"none"}(t)})}),t.forEach(function(e){e.addEventListener("click",function(){return createTask(Number(e.name))})}),n.forEach(function(e){e.addEventListener("click",function(){return deleteTask(e.name)})}),i.forEach(function(e){e.addEventListener("click",function(){return doneTask(e.name)})})}function createElements(e){var r=document.querySelector(".todo"),n="";0<e.length?e.forEach(function(e){var t=!0===e.done?"todo__done ":"";n+='<div class="todo__elements '.concat(t,'">'),n+='<p class="todo__title">'.concat(e.title,"</p>"),n+='<p class="todo__descriptions">'.concat(e.description,"</p>"),n+='<div class="todo__wrapper">',n+='<p class="todo__priority">'.concat(e.priority,"</p>"),n+='<button class="todo__button">...</button>',n+='<div class="todo__buttons">',n+='<button class="todo__buttons-done" name='.concat(e.id,">done</button>"),n+='<button class="todo__buttons-edit" name='.concat(e.id,">edit</button>"),n+='<button class="todo__buttons-delete" name='.concat(e.id,">delete</button>"),n+="</div>",n+="</div>",n+="</div>",r.innerHTML=n}):r.innerHTML="",addEvents(document.querySelectorAll(".todo__button"),document.querySelectorAll(".todo__buttons"),document.querySelectorAll(".todo__buttons-edit"),document.querySelectorAll(".todo__buttons-delete"),document.querySelectorAll(".todo__buttons-done"))}function clearInputs(){titleField.value="",descriptionField.value="",priorityField.selectedIndex=0}function saveTask(e){var t=""!==titleField.value.trim()&&""!==descriptionField.value.trim();if(titleField.value&&descriptionField.value&&priorityField.value&&t){if("number"!=typeof e||Number.isNaN(e))idForArrayItems+=1,taskArray.push({title:titleField.value,description:descriptionField.value,priority:priorityField.value,done:!1,id:idForArrayItems});else{var r=findArrayElement(taskArray,e);r=_objectSpread({},r,{title:titleField.value,description:descriptionField.value,priority:priorityField.value,done:!1}),taskArray=replaceArrayElement(taskArray,r)}clearInputs(),createElements(taskArray),currentId=null,modal.style.display="none",clearSearchFields()}else alert("Please fill out the form")}function cancelTask(){clearInputs(),modal.style.display="none",clearSearchFields()}function selectStatus(e,t){var r=[];return"done"===e?r=t.filter(function(e){return!0===e.done}):"open"===e?r=t.filter(function(e){return!1===e.done}):"all"===e&&(r=t),r}function selectPriority(e,t){var r=[];return"high"===e?r=t.filter(function(e){return"high"===e.priority}):"normal"===e?r=t.filter(function(e){return"normal"===e.priority}):"low"===e?r=t.filter(function(e){return"low"===e.priority}):"all"===e&&(r=t),r}function changeListInput(t,e){return e.filter(function(e){return-1<e.title.indexOf(t)})}function filterInput(r){var e=[];"list-input"===r.target.name&&(e=taskArray.filter(function(e){var t=r.target.value;return-1<e.title.indexOf(t)}),e=selectStatus(listSelectStatus.value,e),e=selectPriority(listSelectPriority.value,e)),"status"===r.target.name&&("done"===r.target.value?e=taskArray.filter(function(e){return!0===e.done}):"open"===r.target.value?e=taskArray.filter(function(e){return!1===e.done}):"all"===r.target.value&&(e=taskArray),e=changeListInput(listInput.value,e),e=selectPriority(listSelectPriority.value,e)),"priority"===r.target.name&&("high"===r.target.value?e=taskArray.filter(function(e){return"high"===e.priority}):"normal"===r.target.value?e=taskArray.filter(function(e){return"normal"===e.priority}):"low"===r.target.value?e=taskArray.filter(function(e){return"low"===e.priority}):"all"===r.target.value&&(e=taskArray),e=changeListInput(listInput.value,e),e=selectStatus(listSelectStatus.value,e)),createElements(e)}function cancelWithEsc(e){27===e.keyCode&&cancelTask()}btnCreate.addEventListener("click",createTask),modalSave.addEventListener("click",function(){return saveTask(currentId)}),modalCancel.addEventListener("click",cancelTask),body.addEventListener("keyup",cancelWithEsc),modalFade.addEventListener("click",cancelTask),listSelectStatus.addEventListener("change",filterInput),listSelectPriority.addEventListener("change",filterInput),listInput.addEventListener("input",filterInput);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiYnRuQ3JlYXRlIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwibGlzdElucHV0IiwibGlzdFNlbGVjdFN0YXR1cyIsImxpc3RTZWxlY3RQcmlvcml0eSIsIm1vZGFsIiwibW9kYWxTYXZlIiwibW9kYWxDYW5jZWwiLCJib2R5IiwibW9kYWxGYWRlIiwiY3VycmVudElkIiwidGFza0FycmF5IiwiaWRGb3JBcnJheUl0ZW1zIiwidGl0bGVGaWVsZCIsImdldEVsZW1lbnRCeUlkIiwiZGVzY3JpcHRpb25GaWVsZCIsInByaW9yaXR5RmllbGQiLCJmaW5kQXJyYXlFbGVtZW50IiwiYXJyIiwiaWQiLCJjdXJyZW50RWxlbWVudCIsImZvckVhY2giLCJlbGVtZW50IiwiTnVtYmVyIiwicmVwbGFjZUFycmF5RWxlbWVudCIsImFycmF5IiwiaXRlbSIsIm1hcCIsInJlbW92ZUFycmF5RWxlbWVudCIsImZpbHRlciIsImNsZWFyU2VhcmNoRmllbGRzIiwidmFsdWUiLCJzZWxlY3RlZEluZGV4IiwiY3JlYXRlVGFzayIsImluZGV4IiwiaXNOYU4iLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwicHJpb3JpdHkiLCJzdHlsZSIsImRpc3BsYXkiLCJmb2N1cyIsImRlbGV0ZVRhc2siLCJjcmVhdGVFbGVtZW50cyIsImRvbmVUYXNrIiwiX29iamVjdFNwcmVhZCIsImRvbmUiLCJhZGRFdmVudHMiLCJ0b2RvQnV0dG9uIiwidG9kb0J1dHRvbnMiLCJ0b2RvQnV0dG9uc0VkaXQiLCJ0b2RvQnV0dG9uRGVsZXRlIiwidG9kb0J1dHRvbkRvbmUiLCJhZGRFdmVudExpc3RlbmVyIiwic2hvd1RvZG9CdXJyb25zIiwibmFtZSIsImFyckVsZW1lbnRzIiwicmVzdWx0Iiwib3V0IiwibGVuZ3RoIiwidG9kb0RvbmVDbGFzc05hbWUiLCJjb25jYXQiLCJpbm5lckhUTUwiLCJxdWVyeVNlbGVjdG9yQWxsIiwiY2xlYXJJbnB1dHMiLCJzYXZlVGFzayIsImVtcHR5Q29uZGl0aW9uIiwidHJpbSIsInB1c2giLCJhbGVydCIsImNhbmNlbFRhc2siLCJzZWxlY3RTdGF0dXMiLCJjdXJyZW50QXJyIiwic2VsZWN0UHJpb3JpdHkiLCJjaGFuZ2VMaXN0SW5wdXQiLCJpbmRleE9mIiwiZmlsdGVySW5wdXQiLCJlIiwibmV3QXJyIiwidGFyZ2V0IiwiY2FuY2VsV2l0aEVzYyIsImtleUNvZGUiXSwibWFwcGluZ3MiOiJ3dUJBQUEsSUFBTUEsVUFBWUMsU0FBU0MsY0FBYyxpQkFDbkNDLFVBQVlGLFNBQVNDLGNBQWMsZ0JBQ25DRSxpQkFBbUJILFNBQVNDLGNBQWMsd0JBQzFDRyxtQkFBcUJKLFNBQVNDLGNBQWMsMEJBQzVDSSxNQUFRTCxTQUFTQyxjQUFjLFVBQy9CSyxVQUFZTixTQUFTQyxjQUFjLHVCQUNuQ00sWUFBY1AsU0FBU0MsY0FBYyx5QkFDckNPLEtBQU9SLFNBQVNDLGNBQWMsUUFDOUJRLFVBQVlULFNBQVNDLGNBQWMsZ0JBRXJDUyxVQUFZLEtBQ1pDLFVBQVksR0FDWkMsZ0JBQWtCLEVBRWhCQyxXQUFhYixTQUFTYyxlQUFlLFNBQ3JDQyxpQkFBbUJmLFNBQVNjLGVBQWUsZUFDM0NFLGNBQWdCaEIsU0FBU2MsZUFBZSxZQUU5QyxTQUFTRyxpQkFBaUJDLEVBQUtDLEdBQzdCLElBQUlDLEVBQWlCLEtBTXJCLE9BTEFGLEVBQUlHLFFBQVEsU0FBQ0MsR0FDUEEsRUFBUUgsS0FBT0ksT0FBT0osS0FDeEJDLEVBQWlCRSxLQUdkRixFQUdULFNBQVNJLG9CQUFvQkMsRUFBT0MsR0FPbEMsT0FOZUQsRUFBTUUsSUFBSSxTQUFDTCxHQUN4QixPQUFJQSxFQUFRSCxLQUFPTyxFQUFLUCxHQUNmTyxFQUVGSixJQUtYLFNBQVNNLG1CQUFtQkgsRUFBT0MsR0FFakMsT0FEZUQsRUFBTUksT0FBTyxTQUFDUCxHQUFELE9BQWFBLEVBQVFILEtBQU9PLEVBQUtQLEtBSS9ELFNBQVNXLG9CQUNQNUIsVUFBVTZCLE1BQVEsR0FDbEI1QixpQkFBaUI2QixjQUFnQixFQUNq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Q1grQyxFQUFTbkUsVUFBVWtCLE9BQU8sU0FBQ1AsR0FBRCxNQUFrQyxTQUFyQkEsRUFBUWdCLFdBQ25CLFdBQW5CdUMsRUFBRUUsT0FBT2hELE1BQ2xCK0MsRUFBU25FLFVBQVVrQixPQUFPLFNBQUNQLEdBQUQsTUFBa0MsV0FBckJBLEVBQVFnQixXQUNuQixRQUFuQnVDLEVBQUVFLE9BQU9oRCxNQUNsQitDLEVBQVNuRSxVQUFVa0IsT0FBTyxTQUFDUCxHQUFELE1BQWtDLFFBQXJCQSxFQUFRZ0IsV0FDbkIsUUFBbkJ1QyxFQUFFRSxPQUFPaEQsUUFDbEIrQyxFQUFTbkUsV0FHWG1FLEVBQVNKLGdCQUFnQnhFLFVBQVU2QixNQUFPK0MsR0FDMUNBLEVBQVNQLGFBQWFwRSxpQkFBaUI0QixNQUFPK0MsSUFHaERuQyxlQUFlbUMsR0FHakIsU0FBU0UsY0FBY0gsR0FDSCxLQUFkQSxFQUFFSSxTQUNKWCxhQUlKdkUsVUFBVXNELGlCQUFpQixRQUFTcEIsWUFDcEMzQixVQUFVK0MsaUJBQWlCLFFBQVMsV0FBQSxPQUFNWSxTQUFTdkQsYUFDbkRILFlBQVk4QyxpQkFBaUIsUUFBU2lCLFlBRXRDOUQsS0FBSzZDLGlCQUFpQixRQUFTMkIsZUFFL0J2RSxVQUFVNEMsaUJBQWlCLFFBQVNpQixZQUVwQ25FLGlCQUFpQmtELGlCQUFpQixTQUFVdUIsYUFDNUN4RSxtQkFBbUJpRCxpQkFBaUIsU0FBVXVCLGFBQzlDMUUsVUFBVW1ELGlCQUFpQixRQUFTdUIiLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBidG5DcmVhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubGlzdF9fYnV0dG9uJyk7XHJcbmNvbnN0IGxpc3RJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5saXN0X19pbnB1dCcpO1xyXG5jb25zdCBsaXN0U2VsZWN0U3RhdHVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmxpc3RfX3NlbGVjdC1zdGF0dXMnKTtcclxuY29uc3QgbGlzdFNlbGVjdFByaW9yaXR5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmxpc3RfX3NlbGVjdC1wcmlvcml0eScpO1xyXG5jb25zdCBtb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbCcpO1xyXG5jb25zdCBtb2RhbFNhdmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2J1dHRvbi1zYXZlJyk7XHJcbmNvbnN0IG1vZGFsQ2FuY2VsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX19idXR0b24tY2FuY2VsJyk7XHJcbmNvbnN0IGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7XHJcbmNvbnN0IG1vZGFsRmFkZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fZmFkZScpO1xyXG5cclxubGV0IGN1cnJlbnRJZCA9IG51bGw7XHJcbmxldCB0YXNrQXJyYXkgPSBbXTtcclxubGV0IGlkRm9yQXJyYXlJdGVtcyA9IDA7XHJcblxyXG5jb25zdCB0aXRsZUZpZWxkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpdGxlJyk7XHJcbmNvbnN0IGRlc2NyaXB0aW9uRmllbGQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGVzY3JpcHRpb24nKTtcclxuY29uc3QgcHJpb3JpdHlGaWVsZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmlvcml0eScpO1xyXG5cclxuZnVuY3Rpb24gZmluZEFycmF5RWxlbWVudChhcnIsIGlkKSB7XHJcbiAgbGV0IGN1cnJlbnRFbGVtZW50ID0gbnVsbDtcclxuICBhcnIuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xyXG4gICAgaWYgKGVsZW1lbnQuaWQgPT09IE51bWJlcihpZCkpIHtcclxuICAgICAgY3VycmVudEVsZW1lbnQgPSBlbGVtZW50O1xyXG4gICAgfVxyXG4gIH0pO1xyXG4gIHJldHVybiBjdXJyZW50RWxlbWVudDtcclxufVxyXG5cclxuZnVuY3Rpb24gcmVwbGFjZUFycmF5RWxlbWVudChhcnJheSwgaXRlbSkge1xyXG4gIGNvbnN0IG5ld0FyciA9IGFycmF5Lm1hcCgoZWxlbWVudCkgPT4ge1xyXG4gICAgaWYgKGVsZW1lbnQuaWQgPT09IGl0ZW0uaWQpIHtcclxuICAgICAgcmV0dXJuIGl0ZW07XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZWxlbWVudDtcclxuICB9KTtcclxuICByZXR1cm4gbmV3QXJyO1xyXG59XHJcblxyXG5mdW5jdGlvbiByZW1vdmVBcnJheUVsZW1lbnQoYXJyYXksIGl0ZW0pIHtcclxuICBjb25zdCBuZXdBcnIgPSBhcnJheS5maWx0ZXIoKGVsZW1lbnQpID0+IGVsZW1lbnQuaWQgIT09IGl0ZW0uaWQpO1xyXG4gIHJldHVybiBuZXdBcnI7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNsZWFyU2VhcmNoRmllbGRzKCkge1xyXG4gIGxpc3RJbnB1dC52YWx1ZSA9ICcnO1xyXG4gIGxpc3RTZWxlY3RTdGF0dXMuc2VsZWN0ZWRJbmRleCA9IDA7XHJcbiAgbGlzdFNlbGVjdFByaW9yaXR5LnNlbGVjdGVkSW5kZXggPSAwO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVUYXNrKGluZGV4KSB7XHJcbiAgaWYgKHR5cGVvZiBpbmRleCA9PT0gJ251bWJlcicgJiYgIU51bWJlci5pc05hTihpbmRleCkpIHtcclxuICAgIGNvbnN0IGN1cnJlbnRFbGVtZW50ID0gZmluZEFycmF5RWxlbWVudCh0YXNrQXJyYXksIGluZGV4KTtcclxuICAgIGNvbnN0IHsgdGl0bGUsIGRlc2NyaXB0aW9uLCBwcmlvcml0eSwgaWQsIH0gPSBjdXJyZW50RWxlbWVudDtcclxuICAgIHRpdGxlRmllbGQudmFsdWUgPSB0aXRsZTtcclxuICAgIGRlc2NyaXB0aW9uRmllbGQudmFsdWUgPSBkZXNjcmlwdGlvbjtcclxuICAgIHByaW9yaXR5RmllbGQudmFsdWUgPSBwcmlvcml0eTtcclxuICAgIGN1cnJlbnRJZCA9IGlkO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBjdXJyZW50SWQgPSBudWxsO1xyXG4gIH1cclxuXHJcbiAgbW9kYWwuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcbiAgdGl0bGVGaWVsZC5mb2N1cygpO1xyXG4gIGNsZWFyU2VhcmNoRmllbGRzKCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGRlbGV0ZVRhc2soaW5kZXgpIHtcclxuICBjb25zdCBjdXJyZW50RWxlbWVudCA9IGZpbmRBcnJheUVsZW1lbnQodGFza0FycmF5LCBpbmRleCk7XHJcbiAgdGFza0FycmF5ID0gcmVtb3ZlQXJyYXlFbGVtZW50KHRhc2tBcnJheSwgY3VycmVudEVsZW1lbnQpO1xyXG4gIGNyZWF0ZUVsZW1lbnRzKHRhc2tBcnJheSk7XHJcbiAgY2xlYXJTZWFyY2hGaWVsZHMoKTtcclxufVxyXG5cclxuZnVuY3Rpb24gZG9uZVRhc2soaW5kZXgpIHtcclxuICBsZXQgY3VycmVudEVsZW1lbnQgPSBmaW5kQXJyYXlFbGVtZW50KHRhc2tBcnJheSwgaW5kZXgpO1xyXG4gIGNvbnN0IGN1cnJlbnREb25lID0gIWN1cnJlbnRFbGVtZW50LmRvbmU7XHJcbiAgY3VycmVudEVsZW1lbnQgPSB7IC4uLmN1cnJlbnRFbGVtZW50LCBkb25lOiBjdXJyZW50RG9uZSwgfTtcclxuICB0YXNrQXJyYXkgPSByZXBsYWNlQXJyYXlFbGVtZW50KHRhc2tBcnJheSwgY3VycmVudEVsZW1lbnQpO1xyXG4gIGNyZWF0ZUVsZW1lbnRzKHRhc2tBcnJheSk7XHJcbiAgY2xlYXJTZWFyY2hGaWVsZHMoKTtcclxufVxyXG5cclxuZnVuY3Rpb24gYWRkRXZlbnRzKHRvZG9CdXR0b24sIHRvZG9CdXR0b25zLCB0b2RvQnV0dG9uc0VkaXQsIHRvZG9CdXR0b25EZWxldGUsIHRvZG9CdXR0b25Eb25lKSB7XHJcbiAgZnVuY3Rpb24gc2hvd1RvZG9CdXJyb25zKGluZGV4KSB7XHJcbiAgICBjb25zdCB0b2RvQnV0dG9uc0FycmF5ID0gdG9kb0J1dHRvbnM7XHJcbiAgICB0b2RvQnV0dG9uc0FycmF5W2luZGV4XS5zdHlsZS5kaXNwbGF5ID0gdG9kb0J1dHRvbnNbaW5kZXhdLnN0eWxlLmRpc3BsYXkgPT09ICdub25lJyA/ICdmbGV4JyA6ICdub25lJztcclxuICB9XHJcblxyXG4gIHRvZG9CdXR0b25zLmZvckVhY2goKGVsZW1lbnQpID0+IHtcclxuICAgIGNvbnN0IHRoaXNFbGVtZW50ID0gZWxlbWVudDtcclxuICAgIHRoaXNFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgfSk7XHJcblxyXG4gIHRvZG9CdXR0b24uZm9yRWFjaCgoZWxlbWVudCwgaW5kZXgpID0+IHtcclxuICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBzaG93VG9kb0J1cnJvbnMoaW5kZXgpKTtcclxuICB9KTtcclxuXHJcbiAgdG9kb0J1dHRvbnNFZGl0LmZvckVhY2goKGVsZW1lbnQpID0+IHtcclxuICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBjcmVhdGVUYXNrKE51bWJlcihlbGVtZW50Lm5hbWUpKSk7XHJcbiAgfSk7XHJcblxyXG4gIHRvZG9CdXR0b25EZWxldGUuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xyXG4gICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IGRlbGV0ZVRhc2soZWxlbWVudC5uYW1lKSk7XHJcbiAgfSk7XHJcblxyXG4gIHRvZG9CdXR0b25Eb25lLmZvckVhY2goKGVsZW1lbnQpID0+IHtcclxuICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBkb25lVGFzayhlbGVtZW50Lm5hbWUpKTtcclxuICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gY3JlYXRlRWxlbWVudHMoYXJyRWxlbWVudHMpIHtcclxuICBjb25zdCByZXN1bHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudG9kbycpO1xyXG5cclxuICBsZXQgb3V0ID0gJyc7XHJcblxyXG4gIGlmIChhcnJFbGVtZW50cy5sZW5ndGggPiAwKSB7XHJcbiAgICBhcnJFbGVtZW50cy5mb3JFYWNoKChlbGVtZW50KSA9PiB7XHJcbiAgICAgIGNvbnN0IHRvZG9Eb25lQ2xhc3NOYW1lID0gZWxlbWVudC5kb25lID09PSB0cnVlID8gJ3RvZG9fX2RvbmUgJyA6ICcnO1xyXG4gICAgICBvdXQgKz0gYDxkaXYgY2xhc3M9XCJ0b2RvX19lbGVtZW50cyAke3RvZG9Eb25lQ2xhc3NOYW1lfVwiPmA7XHJcbiAgICAgIG91dCArPSBgPHAgY2xhc3M9XCJ0b2RvX190aXRsZVwiPiR7ZWxlbWVudC50aXRsZX08L3A+YDtcclxuICAgICAgb3V0ICs9IGA8cCBjbGFzcz1cInRvZG9fX2Rlc2NyaXB0aW9uc1wiPiR7ZWxlbWVudC5kZXNjcmlwdGlvbn08L3A+YDtcclxuICAgICAgb3V0ICs9ICc8ZGl2IGNsYXNzPVwidG9kb19fd3JhcHBlclwiPic7XHJcbiAgICAgIG91dCArPSBgPHAgY2xhc3M9XCJ0b2RvX19wcmlvcml0eVwiPiR7ZWxlbWVudC5wcmlvcml0eX08L3A+YDtcclxuICAgICAgb3V0ICs9ICc8YnV0dG9uIGNsYXNzPVwidG9kb19fYnV0dG9uXCI+Li4uPC9idXR0b24+JztcclxuICAgICAgb3V0ICs9ICc8ZGl2IGNsYXNzPVwidG9kb19fYnV0dG9uc1wiPic7XHJcbiAgICAgIG91dCArPSBgPGJ1dHRvbiBjbGFzcz1cInRvZG9fX2J1dHRvbnMtZG9uZVwiIG5hbWU9JHtlbGVtZW50LmlkfT5kb25lPC9idXR0b24+YDtcclxuICAgICAgb3V0ICs9IGA8YnV0dG9uIGNsYXNzPVwidG9kb19fYnV0dG9ucy1lZGl0XCIgbmFtZT0ke2VsZW1lbnQuaWR9PmVkaXQ8L2J1dHRvbj5gO1xyXG4gICAgICBvdXQgKz0gYDxidXR0b24gY2xhc3M9XCJ0b2RvX19idXR0b25zLWRlbGV0ZVwiIG5hbWU9JHtlbGVtZW50LmlkfT5kZWxldGU8L2J1dHRvbj5gO1xyXG4gICAgICBvdXQgKz0gJzwvZGl2Pic7XHJcbiAgICAgIG91dCArPSAnPC9kaXY+JztcclxuICAgICAgb3V0ICs9ICc8L2Rpdj4nO1xyXG4gICAgICByZXN1bHQuaW5uZXJIVE1MID0gb3V0O1xyXG4gICAgfSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIHJlc3VsdC5pbm5lckhUTUwgPSAnJztcclxuICB9XHJcblxyXG4gIGNvbnN0IHRvZG9CdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudG9kb19fYnV0dG9uJyk7XHJcbiAgY29uc3QgdG9kb0J1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudG9kb19fYnV0dG9ucycpO1xyXG4gIGNvbnN0IHRvZG9CdXR0b25zRWRpdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy50b2RvX19idXR0b25zLWVkaXQnKTtcclxuICBjb25zdCB0b2RvQnV0dG9uRGVsZXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRvZG9fX2J1dHRvbnMtZGVsZXRlJyk7XHJcbiAgY29uc3QgdG9kb0J1dHRvbkRvbmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudG9kb19fYnV0dG9ucy1kb25lJyk7XHJcblxyXG4gIGFkZEV2ZW50cyh0b2RvQnV0dG9uLCB0b2RvQnV0dG9ucywgdG9kb0J1dHRvbnNFZGl0LCB0b2RvQnV0dG9uRGVsZXRlLCB0b2RvQnV0dG9uRG9uZSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNsZWFySW5wdXRzKCkge1xyXG4gIHRpdGxlRmllbGQudmFsdWUgPSAnJztcclxuICBkZXNjcmlwdGlvbkZpZWxkLnZhbHVlID0gJyc7XHJcbiAgcHJpb3JpdHlGaWVsZC5zZWxlY3RlZEluZGV4ID0gMDtcclxufVxyXG5cclxuZnVuY3Rpb24gc2F2ZVRhc2soaW5kZXgpIHtcclxuICBjb25zdCBlbXB0eUNvbmRpdGlvbiA9IHRpdGxlRmllbGQudmFsdWUudHJpbSgpICE9PSAnJyAmJiBkZXNjcmlwdGlvbkZpZWxkLnZhbHVlLnRyaW0oKSAhPT0gJyc7XHJcbiAgY29uc3QgdmFsdWVDb25kaXRpb24gPSB0aXRsZUZpZWxkLnZhbHVlICYmIGRlc2NyaXB0aW9uRmllbGQudmFsdWUgJiYgcHJpb3JpdHlGaWVsZC52YWx1ZTtcclxuXHJcbiAgaWYgKHZhbHVlQ29uZGl0aW9uICYmIGVtcHR5Q29uZGl0aW9uKSB7XHJcbiAgICBpZiAodHlwZW9mIGluZGV4ID09PSAnbnVtYmVyJyAmJiAhTnVtYmVyLmlzTmFOKGluZGV4KSkge1xyXG4gICAgICBsZXQgY3VycmVudEVsZW1lbnQgPSBmaW5kQXJyYXlFbGVtZW50KHRhc2tBcnJheSwgaW5kZXgpO1xyXG4gICAgICBjdXJyZW50RWxlbWVudCA9IHtcclxuICAgICAgICAuLi5jdXJyZW50RWxlbWVudCxcclxuICAgICAgICB0aXRsZTogdGl0bGVGaWVsZC52YWx1ZSxcclxuICAgICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb25GaWVsZC52YWx1ZSxcclxuICAgICAgICBwcmlvcml0eTogcHJpb3JpdHlGaWVsZC52YWx1ZSxcclxuICAgICAgICBkb25lOiBmYWxzZSxcclxuICAgICAgfTtcclxuICAgICAgdGFza0FycmF5ID0gcmVwbGFjZUFycmF5RWxlbWVudCh0YXNrQXJyYXksIGN1cnJlbnRFbGVtZW50KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGlkRm9yQXJyYXlJdGVtcyArPSAxO1xyXG4gICAgICB0YXNrQXJyYXkucHVzaCh7XHJcbiAgICAgICAgdGl0bGU6IHRpdGxlRmllbGQudmFsdWUsXHJcbiAgICAgICAgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uRmllbGQudmFsdWUsXHJcbiAgICAgICAgcHJpb3JpdHk6IHByaW9yaXR5RmllbGQudmFsdWUsXHJcbiAgICAgICAgZG9uZTogZmFsc2UsXHJcbiAgICAgICAgaWQ6IGlkRm9yQXJyYXlJdGVtcyxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY2xlYXJJbnB1dHMoKTtcclxuICAgIGNyZWF0ZUVsZW1lbnRzKHRhc2tBcnJheSk7XHJcbiAgICBjdXJyZW50SWQgPSBudWxsO1xyXG4gICAgbW9kYWwuc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgIGNsZWFyU2VhcmNoRmllbGRzKCk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGFsZXJ0KCdQbGVhc2UgZmlsbCBvdXQgdGhlIGZvcm0nKTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNhbmNlbFRhc2soKSB7XHJcbiAgY2xlYXJJbnB1dHMoKTtcclxuICBtb2RhbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gIGNsZWFyU2VhcmNoRmllbGRzKCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNlbGVjdFN0YXR1cyh2YWx1ZSwgYXJyKSB7XHJcbiAgbGV0IGN1cnJlbnRBcnIgPSBbXTtcclxuXHJcbiAgaWYgKHZhbHVlID09PSAnZG9uZScpIHtcclxuICAgIGN1cnJlbnRBcnIgPSBhcnIuZmlsdGVyKChlbGVtZW50KSA9PiBlbGVtZW50LmRvbmUgPT09IHRydWUpO1xyXG4gIH0gZWxzZSBpZiAodmFsdWUgPT09ICdvcGVuJykge1xyXG4gICAgY3VycmVudEFyciA9IGFyci5maWx0ZXIoKGVsZW1lbnQpID0+IGVsZW1lbnQuZG9uZSA9PT0gZmFsc2UpO1xyXG4gIH0gZWxzZSBpZiAodmFsdWUgPT09ICdhbGwnKSB7XHJcbiAgICBjdXJyZW50QXJyID0gYXJyO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGN1cnJlbnRBcnI7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNlbGVjdFByaW9yaXR5KHZhbHVlLCBhcnIpIHtcclxuICBsZXQgY3VycmVudEFyciA9IFtdO1xyXG5cclxuICBpZiAodmFsdWUgPT09ICdoaWdoJykge1xyXG4gICAgY3VycmVudEFyciA9IGFyci5maWx0ZXIoKGVsZW1lbnQpID0+IGVsZW1lbnQucHJpb3JpdHkgPT09ICdoaWdoJyk7XHJcbiAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gJ25vcm1hbCcpIHtcclxuICAgIGN1cnJlbnRBcnIgPSBhcnIuZmlsdGVyKChlbGVtZW50KSA9PiBlbGVtZW50LnByaW9yaXR5ID09PSAnbm9ybWFsJyk7XHJcbiAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gJ2xvdycpIHtcclxuICAgIGN1cnJlbnRBcnIgPSBhcnIuZmlsdGVyKChlbGVtZW50KSA9PiBlbGVtZW50LnByaW9yaXR5ID09PSAnbG93Jyk7XHJcbiAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gJ2FsbCcpIHtcclxuICAgIGN1cnJlbnRBcnIgPSBhcnI7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gY3VycmVudEFycjtcclxufVxyXG5cclxuZnVuY3Rpb24gY2hhbmdlTGlzdElucHV0KHZhbHVlLCBhcnIpIHtcclxuICBsZXQgY3VycmVudEFyciA9IFtdO1xyXG5cclxuICBjdXJyZW50QXJyID0gYXJyLmZpbHRlcigoZWxlbWVudCkgPT4ge1xyXG4gICAgcmV0dXJuIGVsZW1lbnQudGl0bGUuaW5kZXhPZih2YWx1ZSkgPiAtMTtcclxuICB9KTtcclxuXHJcbiAgcmV0dXJuIGN1cnJlbnRBcnI7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGZpbHRlcklucHV0KGUpIHtcclxuICBsZXQgbmV3QXJyID0gW107XHJcblxyXG4gIGlmIChlLnRhcmdldC5uYW1lID09PSAnbGlzdC1pbnB1dCcpIHtcclxuICAgIG5ld0FyciA9IHRhc2tBcnJheS5maWx0ZXIoKGVsZW1lbnQpID0+IHtcclxuICAgICAgY29uc3QgeyB2YWx1ZSwgfSA9IGUudGFyZ2V0O1xyXG4gICAgICByZXR1cm4gZWxlbWVudC50aXRsZS5pbmRleE9mKHZhbHVlKSA+IC0xO1xyXG4gICAgfSk7XHJcbiAgICBuZXdBcnIgPSBzZWxlY3RTdGF0dXMobGlzdFNlbGVjdFN0YXR1cy52YWx1ZSwgbmV3QXJyKTtcclxuICAgIG5ld0FyciA9IHNlbGVjdFByaW9yaXR5KGxpc3RTZWxlY3RQcmlvcml0eS52YWx1ZSwgbmV3QXJyKTtcclxuICB9XHJcblxyXG4gIGlmIChlLnRhcmdldC5uYW1lID09PSAnc3RhdHVzJykge1xyXG4gICAgaWYgKGUudGFyZ2V0LnZhbHVlID09PSAnZG9uZScpIHtcclxuICAgICAgbmV3QXJyID0gdGFza0FycmF5LmZpbHRlcigoZWxlbWVudCkgPT4gZWxlbWVudC5kb25lID09PSB0cnVlKTtcclxuICAgIH0gZWxzZSBpZiAoZS50YXJnZXQudmFsdWUgPT09ICdvcGVuJykge1xyXG4gICAgICBuZXdBcnIgPSB0YXNrQXJyYXkuZmlsdGVyKChlbGVtZW50KSA9PiBlbGVtZW50LmRvbmUgPT09IGZhbHNlKTtcclxuICAgIH0gZWxzZSBpZiAoZS50YXJnZXQudmFsdWUgPT09ICdhbGwnKSB7XHJcbiAgICAgIG5ld0FyciA9IHRhc2tBcnJheTtcclxuICAgIH1cclxuXHJcbiAgICBuZXdBcnIgPSBjaGFuZ2VMaXN0SW5wdXQobGlzdElucHV0LnZhbHVlLCBuZXdBcnIpO1xyXG4gICAgbmV3QXJyID0gc2VsZWN0UHJpb3JpdHkobGlzdFNlbGVjdFByaW9yaXR5LnZhbHVlLCBuZXdBcnIpO1xyXG4gIH1cclxuXHJcbiAgaWYgKGUudGFyZ2V0Lm5hbWUgPT09ICdwcmlvcml0eScpIHtcclxuICAgIGlmIChlLnRhcmdldC52YWx1ZSA9PT0gJ2hpZ2gnKSB7XHJcbiAgICAgIG5ld0FyciA9IHRhc2tBcnJheS5maWx0ZXIoKGVsZW1lbnQpID0+IGVsZW1lbnQucHJpb3JpdHkgPT09ICdoaWdoJyk7XHJcbiAgICB9IGVsc2UgaWYgKGUudGFyZ2V0LnZhbHVlID09PSAnbm9ybWFsJykge1xyXG4gICAgICBuZXdBcnIgPSB0YXNrQXJyYXkuZmlsdGVyKChlbGVtZW50KSA9PiBlbGVtZW50LnByaW9yaXR5ID09PSAnbm9ybWFsJyk7XHJcbiAgICB9IGVsc2UgaWYgKGUudGFyZ2V0LnZhbHVlID09PSAnbG93Jykge1xyXG4gICAgICBuZXdBcnIgPSB0YXNrQXJyYXkuZmlsdGVyKChlbGVtZW50KSA9PiBlbGVtZW50LnByaW9yaXR5ID09PSAnbG93Jyk7XHJcbiAgICB9IGVsc2UgaWYgKGUudGFyZ2V0LnZhbHVlID09PSAnYWxsJykge1xyXG4gICAgICBuZXdBcnIgPSB0YXNrQXJyYXk7XHJcbiAgICB9XHJcblxyXG4gICAgbmV3QXJyID0gY2hhbmdlTGlzdElucHV0KGxpc3RJbnB1dC52YWx1ZSwgbmV3QXJyKTtcclxuICAgIG5ld0FyciA9IHNlbGVjdFN0YXR1cyhsaXN0U2VsZWN0U3RhdHVzLnZhbHVlLCBuZXdBcnIpO1xyXG4gIH1cclxuXHJcbiAgY3JlYXRlRWxlbWVudHMobmV3QXJyKTtcclxufVxyXG5cclxuZnVuY3Rpb24gY2FuY2VsV2l0aEVzYyhlKSB7XHJcbiAgaWYgKGUua2V5Q29kZSA9PT0gMjcpIHtcclxuICAgIGNhbmNlbFRhc2soKTtcclxuICB9XHJcbn1cclxuXHJcbmJ0bkNyZWF0ZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNyZWF0ZVRhc2spO1xyXG5tb2RhbFNhdmUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBzYXZlVGFzayhjdXJyZW50SWQpKTtcclxubW9kYWxDYW5jZWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjYW5jZWxUYXNrKTtcclxuXHJcbmJvZHkuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBjYW5jZWxXaXRoRXNjKTtcclxuXHJcbm1vZGFsRmFkZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNhbmNlbFRhc2spO1xyXG5cclxubGlzdFNlbGVjdFN0YXR1cy5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmaWx0ZXJJbnB1dCk7XHJcbmxpc3RTZWxlY3RQcmlvcml0eS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmaWx0ZXJJbnB1dCk7XHJcbmxpc3RJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIGZpbHRlcklucHV0KTtcclxuIl19
